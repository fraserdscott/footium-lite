{"version":3,"file":"_id_.svelte-88baad84.js","sources":["../../../../../../src/lib/player/player.ts","../../../../../../src/routes/player/[id].svelte"],"sourcesContent":["import type { Readable } from 'svelte/store';\nimport { derived } from 'svelte/store';\nimport type { TransactionStore } from 'web3w';\nimport type { Invalidator, Subscriber, Unsubscriber } from 'web3w/dist/esm/utils/internals';\nimport { SUBGRAPH_ENDPOINT } from '$lib/blockchain/subgraph';\nimport { transactions } from '$lib/blockchain/wallet';\nimport type { QueryState, QueryStore } from '$lib/utils/stores/graphql';\nimport { HookedQueryStore } from '$lib/utils/stores/graphql';\nimport type { EndPoint } from '$lib/utils/graphql/endpoint';\nimport { chainTempo } from '$lib/blockchain/chainTempo';\n\ntype Player = {\n  id: string;\n  owner: { id: string };\n  traits: number[];\n  image: string;\n  goalKeeper: boolean;\n  pending: boolean;\n};\n\n// TODO web3w needs to export the type\ntype TransactionStatus = 'pending' | 'cancelled' | 'success' | 'failure' | 'mined';\ntype TransactionRecord = {\n  hash: string;\n  from: string;\n  submissionBlockTime: number;\n  acknowledged: boolean;\n  status: TransactionStatus;\n  nonce: number;\n  confirmations: number;\n  finalized: boolean;\n  lastAcknowledgment?: TransactionStatus;\n  to?: string;\n  gasLimit?: string;\n  gasPrice?: string;\n  data?: string;\n  value?: string;\n  contractName?: string;\n  method?: string;\n  args?: unknown[];\n  eventsABI?: unknown; // TODO\n  metadata?: unknown;\n  lastCheck?: number;\n  blockHash?: string;\n  blockNumber?: number;\n  events?: unknown[]; // TODO\n};\n\nclass PlayerStore implements QueryStore<Player> {\n  private queryStore: QueryStore<Player>;\n  private store: Readable<QueryState<Player>>;\n  constructor(endpoint: EndPoint, private transactions: TransactionStore, id: string) {\n    this.queryStore = new HookedQueryStore(\n      endpoint,\n      `\n    query GetPlayer($id: ID){\n      player(id: $id) {\n        id\n        owner {\n          id\n        }\n        traits\n        goalKeeper\n        image\n      }\n    }`,\n      chainTempo,\n      { path: 'player', variables: { id } },\n    );\n    this.store = derived([this.queryStore, this.transactions], (values) => this.update(values)); // lambda ensure update is not bound and can be hot swapped on HMR\n  }\n\n  private update([$query]: [QueryState<Player>, TransactionRecord[]]): QueryState<Player> {\n    if (!$query.data) {\n      return $query;\n    } else {\n      let newData = $query.data;\n      return {\n        step: $query.step,\n        error: $query.error,\n        data: newData,\n      };\n    }\n  }\n\n  acknowledgeError() {\n    return this.queryStore.acknowledgeError();\n  }\n\n  subscribe(\n    run: Subscriber<QueryState<Player>>,\n    invalidate?: Invalidator<QueryState<Player>> | undefined\n  ): Unsubscriber {\n    return this.store.subscribe(run, invalidate);\n  }\n}\n\nexport const getPlayer = (tokenId: string) => new PlayerStore(SUBGRAPH_ENDPOINT, transactions, tokenId);\n","<script lang=\"ts\">\n  import {getPlayer} from '$lib/player/player';\n  import {flow} from '$lib/blockchain/wallet';\n  import WalletAccess from '$lib/blockchain/WalletAccess.svelte';\n  import {page} from '$app/stores';\n  import {BigNumber} from '@ethersproject/bignumber';\n\n  const player = getPlayer($page.params.id);\n\n  async function mintPlayer(tokenId: string) {\n    await flow.execute((contracts) =>\n      contracts.FootiumLitePlayers.mint(tokenId, {value: BigNumber.from('10000000000000000')})\n    );\n  }\n</script>\n\n<symbol id=\"icon-spinner6\" viewBox=\"0 0 32 32\">\n  <path\n    d=\"M12 4c0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.209-1.791 4-4 4s-4-1.791-4-4zM24.719 16c0 0 0 0 0 0 0-1.812 1.469-3.281 3.281-3.281s3.281 1.469 3.281 3.281c0 0 0 0 0 0 0 1.812-1.469 3.281-3.281 3.281s-3.281-1.469-3.281-3.281zM21.513 24.485c0-1.641 1.331-2.972 2.972-2.972s2.972 1.331 2.972 2.972c0 1.641-1.331 2.972-2.972 2.972s-2.972-1.331-2.972-2.972zM13.308 28c0-1.487 1.205-2.692 2.692-2.692s2.692 1.205 2.692 2.692c0 1.487-1.205 2.692-2.692 2.692s-2.692-1.205-2.692-2.692zM5.077 24.485c0-1.346 1.092-2.438 2.438-2.438s2.438 1.092 2.438 2.438c0 1.346-1.092 2.438-2.438 2.438s-2.438-1.092-2.438-2.438zM1.792 16c0-1.22 0.989-2.208 2.208-2.208s2.208 0.989 2.208 2.208c0 1.22-0.989 2.208-2.208 2.208s-2.208-0.989-2.208-2.208zM5.515 7.515c0 0 0 0 0 0 0-1.105 0.895-2 2-2s2 0.895 2 2c0 0 0 0 0 0 0 1.105-0.895 2-2 2s-2-0.895-2-2zM28.108 7.515c0 2.001-1.622 3.623-3.623 3.623s-3.623-1.622-3.623-3.623c0-2.001 1.622-3.623 3.623-3.623s3.623 1.622 3.623 3.623z\"\n  />\n</symbol>\n<WalletAccess>\n  <div class=\"py-8 px-4\">\n    <b>Player {$page.params.id}</b>\n    {#if !$player.step}\n      <div>player not loaded</div>\n    {:else if $player.error}\n      <div>Error: {$player.error}</div>\n    {:else if $player.step === 'LOADING' || !$player.data}\n      <div>\n        <p>This player has not been minted yet.</p>\n        <p>Cost: 0.01 ETH</p>\n        <button\n          on:click={() => mintPlayer($page.params.id)}\n          class=\"flex-shrink-0 bg-pink-600 hover:bg-pink-700 border-pink-600 hover:border-pink-700 text-sm border-4\n                text-white py-1 px-2 rounded disabled:bg-gray-400 disabled:border-gray-400 disabled:cursor-not-allowed\"\n          type=\"button\"\n        >\n          Mint\n        </button>\n      </div>\n    {:else}\n      <div class=\"px-2\">\n        <svg width=\"150\">\n          {@html $player.data.image}\n        </svg>\n        <p>\n          Owner: {$player.data.owner.id}\n        </p>\n        {$player.data.goalKeeper ? 'Goalkeeper' : 'Regular player'}\n        <h2>General traits</h2>\n        <table class=\"border\">\n          <tr>\n            <th>Trait</th>\n            <th>Value</th>\n          </tr>\n          <tr>\n            <td>Composure</td>\n            <td>{$player.data.traits[0]} / 10</td>\n          </tr>\n          <tr>\n            <td>Height</td>\n            <td>{$player.data.traits[1]} / 10</td>\n          </tr>\n          <tr>\n            <td>Footedness</td>\n            <td>{$player.data.traits[2]} / 10</td>\n          </tr>\n        </table>\n        <h2>Specific traits</h2>\n        <table class=\"border\">\n          <tr>\n            <th>Trait</th>\n            <th>Value</th>\n          </tr>\n          <tr>\n            <td>{$player.data.goalKeeper ? 'Reflexes' : 'Power'}</td>\n            <td>{$player.data.traits[3]} / 10</td>\n          </tr>\n          <tr>\n            <td>{$player.data.goalKeeper ? 'Handling' : 'Accuracy'}</td>\n            <td>{$player.data.traits[4]} / 10</td>\n          </tr>\n          <tr>\n            <td>{$player.data.goalKeeper ? 'Intimidation' : 'Technique'}</td>\n            <td>{$player.data.traits[5]} / 10</td>\n          </tr>\n          <tr>\n            <td>{$player.data.goalKeeper ? 'Jumping' : 'Speed'}</td>\n            <td>{$player.data.traits[6]} / 10</td>\n          </tr>\n        </table>\n      </div>\n    {/if}\n  </div>\n</WalletAccess>\n\n<style>\n  ::-webkit-input-placeholder {\n    /* Chrome/Opera/Safari */\n    color: gray;\n    opacity: 0.5;\n  }\n  ::-moz-placeholder {\n    /* Firefox 19+ */\n    color: gray;\n    opacity: 0.5;\n  }\n  :-ms-input-placeholder {\n    /* IE 10+ */\n    color: gray;\n    opacity: 0.5;\n  }\n  :-moz-placeholder {\n    /* Firefox 18- */\n    color: gray;\n    opacity: 0.5;\n  }\n  @media (prefers-color-scheme: dark) {\n    ::-webkit-input-placeholder {\n      /* Chrome/Opera/Safari */\n      color: pink;\n      opacity: 0.5;\n    }\n    ::-moz-placeholder {\n      /* Firefox 19+ */\n      color: pink;\n      opacity: 0.5;\n    }\n    :-ms-input-placeholder {\n      /* IE 10+ */\n      color: pink;\n      opacity: 0.5;\n    }\n    :-moz-placeholder {\n      /* Firefox 18- */\n      color: pink;\n      opacity: 0.5;\n    }\n  }\n</style>\n"],"names":[],"mappings":"yjBAgDA,QAAgD,CAG9C,YAAY,EAA4B,EAAgC,EAAY,0BAC7E,WAAa,GAAI,IACpB,EACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAYA,GACA,CAAE,KAAM,SAAU,UAAW,CAAE,aAE5B,MAAQ,GAAQ,CAAC,KAAK,WAAY,KAAK,cAAe,AAAC,GAAW,KAAK,OAAO,IAG7E,OAAO,CAAC,GAAwE,IACjF,EAAO,KAEL,IACD,GAAU,EAAO,WACd,CACL,KAAM,EAAO,KACb,MAAO,EAAO,MACd,KAAM,cAND,GAWX,kBAAmB,OACV,MAAK,WAAW,mBAGzB,UACE,EACA,EACc,OACP,MAAK,MAAM,UAAU,EAAK,SAIxB,IAAY,AAAC,GAAoB,GAAI,IAAY,GAAmB,GAAc,4BCrD9E,KAAQ,KAAK,iBAGZ,KAAQ,KAAK,MAAM,YAE5B,MAAQ,KAAK,WAAa,aAAe,kEASjC,KAAQ,KAAK,OAAO,8BAIpB,KAAQ,KAAK,OAAO,+BAIpB,KAAQ,KAAK,OAAO,sDAUpB,MAAQ,KAAK,WAAa,WAAa,uBACvC,KAAQ,KAAK,OAAO,uBAGpB,MAAQ,KAAK,WAAa,WAAa,0BACvC,KAAQ,KAAK,OAAO,uBAGpB,MAAQ,KAAK,WAAa,eAAiB,2BAC3C,KAAQ,KAAK,OAAO,uBAGpB,MAAQ,KAAK,WAAa,UAAY,uBACtC,KAAQ,KAAK,OAAO,iEA3C3B,mDAIE,8DAGI,+BACA,yCAGA,4CACwB,yCAGxB,yCACwB,0CAGxB,6CACwB,gCAG5B,iEAGI,gCACA,6EAIwB,6EAIA,6EAIA,6EAIA,uKA3C9B,oGAIE,2JAGI,4EACA,4HAGA,4FACwB,4HAGxB,yFACwB,8HAGxB,6FACwB,uGAG5B,+JAGI,8EACA,iNAIwB,iNAIA,iNAIA,iNAIA,6lCA/ClC,SACE,4BAGA,0CAIA,qBACA,OACE,OACE,uBACA,uBAEF,OACE,uBACA,+BAEF,OACE,uBACA,+BAEF,OACE,yBACA,+BAGJ,yBACA,OACE,OACE,yBACA,yBAEF,OACE,yBACA,+BAEF,OACE,yBACA,+BAEF,OACE,yBACA,+BAEF,OACE,yBACA,2CA7CK,KAAQ,KAAK,uCAGZ,KAAQ,KAAK,MAAM,2BAE5B,MAAQ,KAAK,WAAa,aAAe,4CASjC,KAAQ,KAAK,OAAO,+BAIpB,KAAQ,KAAK,OAAO,+BAIpB,KAAQ,KAAK,OAAO,+BAUpB,MAAQ,KAAK,WAAa,WAAa,qCACvC,KAAQ,KAAK,OAAO,+BAGpB,MAAQ,KAAK,WAAa,WAAa,wCACvC,KAAQ,KAAK,OAAO,+BAGpB,MAAQ,KAAK,WAAa,eAAiB,yCAC3C,KAAQ,KAAK,OAAO,+BAGpB,MAAQ,KAAK,WAAa,UAAY,qCACtC,KAAQ,KAAK,OAAO,6GA3D1B,2DACA,0CAMH,iGAPG,mGACA,0FAMH,2YARF,SACE,qBACA,qBACA,oGALW,KAAQ,qCAAhB,0EAAA,oFAAL,2CAAa,KAAQ,mFAFhB,6EAAA,qFAAL,gEAFS,KAAM,OAAO,gCAClB,MAAQ,KAEJ,KAAQ,SAER,KAAQ,OAAS,YAAc,KAAQ,mEAL9C,uHAAA,sJADL,SACE,4DAAW,KAAM,OAAO,g+CAP5B,SACE,wPAVM,GAAS,GAAU,EAAM,OAAO,yCAEZ,QAClB,IAAK,QAAS,GAClB,EAAU,mBAAmB,KAAK,GAAU,MAAO,GAAU,KAAK,2CAsB9C,EAAW,EAAM,OAAO"}